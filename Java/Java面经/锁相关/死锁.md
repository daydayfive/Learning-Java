[toc]
# Java 实例-死锁即解决方法


java 死锁如何避免？
造成死锁的几个原因：
1. 互斥使用：一个资源被一个线程占有时，别的线程不能使用
2. 不可抢占：资源请求者不能强制从资源占有者手中夺取资源，资源只能由资源占有者主动释放
3. 请求和保持：即当资源请求者在请求其他的资源的同时保持对原有资源的占有
4. 循环等待：即存在一个等待队列：P1占有P2的资源，P2占有P3的资源，P3占有P1的资源。 这样就形成了一个等待环路。


这是造成死锁必须达到的4个条件，只要打破上述的任何一个条件，就可以让死锁消失。

互斥条件不可被打破。

1）打破不可抢占条件：允许线程强行从占有者那里夺取资源。 就是说，一个线程已经占有了某些资源，但不能被满足时，它必须释放所占有的全部资源，以后再重新申请。它所释放的资源可以分配给其他进程。这就相当于该进程占有的资源被隐蔽地抢占了。这种预防死锁地方法实现起来困难，会降低系统性能。

2）打破请求和保持：可以通过资源预分配策略，即进程再运行前一次性地向系统申请它所需要的全部资源。如果某个进程所需的全部资源得不到满足，则不分配任何资源。
* 这种方式资源利用率低
* 并且降低了进程的并发性
* 而且在一开始不可能知道它所需要的全部资源。


3） 打破循环等待条件： 实现资源有序分配策略。采用这种策略，即把资源事先分类编号，按号分配，使进程再申请，占用资源时不会形成环路。所有进程对资源的请求必须严格按资源序号递增的顺序提出。进程占用了小号资源，才能申请大号资源，就不会产生环路，从而预防了死锁。
（1）限制了进程对资源的请求，同时给系统中所有资源合理编号也是件困难事，并增加了系统开销；
（2）为了遵循按编号申请的次序，暂不使用的资源也需要提前申请，从而增加了进程对资源的占用时间。