# mysql主从同步原理


mysql主从同步的过程：

Mysql的主从复制中主要有三个线程：master(binlog dump thread),slave(I/O thread, SQL thread),Master 一条线程和slave中的两条线程。


* 主节点 binlog，主从复制的基础是主库记录数据库的所有变更记录到binlog。 binlog是数据库服务器启动的那一刻起，保存所有修改数据库结构或内容的一个文件。
* 主节点 log dump线程，当binlog有变动，log dump线程读取其内容并发送给从节点
* 从节点I/O线程接收binlog内容，并将其写入到relay log文件中。
* 从节点的SQL线程读取relay log内文件内容对数据更新进行重放，最终保证主从数据库的一致性。

注：主从节点使用binlog文件+position 偏移量来定位主从同步的位置，从节点回保存其已接受到的偏移量，如果从节点发生宕机重启，则会自动从position的位置发起同步。




## 全同步复制
主库写入binlog后强制所有同步日志到从库，所有的从库都执行完成后才返回给客户端，但是很显然这个方式的话性能收到严重影响。

## 半同步复制
和全同步不同的是，半同步复制的逻辑是这样，从库写入日志成功后返回ACK确认给主库，主库收到一个从库的确认就可完成。